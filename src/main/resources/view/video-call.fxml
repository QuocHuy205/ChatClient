<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:controller="vku.chatapp.client.controller.VideoCallController"
      prefWidth="1000" prefHeight="750"
      minWidth="1000" minHeight="750"
      maxWidth="1000" maxHeight="750"
      spacing="0"
      style="-fx-background-color: #1a1a1a;">

    <!-- Header (Fixed 60px) -->
    <HBox alignment="CENTER" spacing="15"
          prefHeight="60" minHeight="60" maxHeight="60"
          style="-fx-background-color: #2d2d2d; -fx-padding: 15;">

        <Label fx:id="peerNameLabel" text="Connecting..."
               style="-fx-text-fill: white; -fx-font-size: 20px; -fx-font-weight: bold;"/>

        <Region HBox.hgrow="ALWAYS"/>

        <Label fx:id="callStatusLabel" text="â³ Calling..."
               style="-fx-text-fill: #90ee90; -fx-font-size: 15px; -fx-padding: 0 15 0 0;"/>

        <Label fx:id="callDurationLabel" text="00:00"
               style="-fx-text-fill: white; -fx-font-size: 16px; -fx-font-weight: bold; -fx-background-color: rgba(255,255,255,0.1); -fx-padding: 5 15; -fx-background-radius: 15;"/>
    </HBox>

    <!-- Video Container (Fixed 590px) -->
    <StackPane fx:id="callContainer"
               prefWidth="1000" prefHeight="590"
               minWidth="1000" minHeight="590"
               maxWidth="1000" maxHeight="590"
               style="-fx-background-color: #000000;">

        <!-- Remote Video (Background - Full Size) -->
        <StackPane StackPane.alignment="CENTER">
            <ImageView fx:id="remoteVideoView"
                       preserveRatio="true"
                       fitWidth="1000"
                       fitHeight="590"
                       style="-fx-background-color: #0a0a0a;">
            </ImageView>

            <!-- Placeholder when no video -->
            <VBox fx:id="remoteVideoPlaceholder"
                  alignment="CENTER" spacing="15"
                  style="-fx-background-color: rgba(0,0,0,0.7);">
                <Label text="ðŸ“¹" style="-fx-font-size: 60px;"/>
                <Label text="Waiting for video..."
                       style="-fx-text-fill: white; -fx-font-size: 20px; -fx-font-weight: bold;"/>
            </VBox>
        </StackPane>

        <!-- Local Video (Picture-in-Picture - Bottom Right) -->
        <HBox alignment="BOTTOM_RIGHT"
              StackPane.alignment="BOTTOM_RIGHT">
            <padding>
                <Insets bottom="20" right="20"/>
            </padding>

            <StackPane style="-fx-background-color: #1a1a1a; -fx-border-color: rgba(255,255,255,0.4); -fx-border-width: 3; -fx-background-radius: 15; -fx-border-radius: 15; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.8), 20, 0, 0, 5);">

                <!-- Local Video -->
                <ImageView fx:id="localVideoView"
                           preserveRatio="true"
                           fitWidth="280"
                           fitHeight="210"
                           style="-fx-background-color: #0a0a0a; -fx-background-radius: 12;">
                </ImageView>

                <!-- "You" Label -->
                <HBox alignment="CENTER" spacing="5"
                      style="-fx-background-color: rgba(0,0,0,0.75); -fx-padding: 6 12; -fx-background-radius: 8;"
                      StackPane.alignment="BOTTOM_CENTER">
                    <StackPane.margin>
                        <Insets bottom="10"/>
                    </StackPane.margin>
                    <Label text="ðŸ“¹" style="-fx-font-size: 13px;"/>
                    <Label text="You"
                           style="-fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: bold;"/>
                </HBox>
            </StackPane>
        </HBox>

        <!-- Connection Status Badge (Top Left) -->
        <HBox alignment="CENTER" spacing="6"
              StackPane.alignment="TOP_LEFT"
              style="-fx-background-color: rgba(0,0,0,0.65); -fx-padding: 8 15; -fx-background-radius: 12; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.5), 8, 0, 0, 2);">
            <StackPane.margin>
                <Insets top="15" left="15"/>
            </StackPane.margin>
            <Label text="ðŸ”´" style="-fx-font-size: 12px;"/>
            <Label text="LIVE" style="-fx-text-fill: white; -fx-font-size: 12px; -fx-font-weight: bold;"/>
        </HBox>
    </StackPane>

    <!-- Control Panel (Fixed 100px) -->
    <HBox alignment="CENTER" spacing="25"
          prefHeight="100" minHeight="100" maxHeight="100"
          style="-fx-background-color: #2d2d2d; -fx-padding: 20;">

        <!-- Mute Button -->
        <VBox alignment="CENTER" spacing="6">
            <StackPane>
                <Button fx:id="muteButton"
                        onAction="#handleMute"
                        prefWidth="58" prefHeight="58"
                        style="-fx-background-color: #4a4a4a; -fx-background-radius: 50%; -fx-cursor: hand; -fx-border-color: transparent; -fx-border-width: 0;">
                    <graphic>
                        <Label text="ðŸŽ¤" style="-fx-font-size: 24px;"/>
                    </graphic>
                </Button>
                <!-- Hover Effect Circle -->
                <StackPane style="-fx-background-color: transparent; -fx-pref-width: 58; -fx-pref-height: 58; -fx-background-radius: 50%;" mouseTransparent="true"/>
            </StackPane>
            <Label fx:id="muteLabel" text="Mute"
                   style="-fx-text-fill: #b8b8b8; -fx-font-size: 11px; -fx-font-weight: 600;"/>
        </VBox>

        <!-- Video Toggle Button -->
        <VBox alignment="CENTER" spacing="6">
            <StackPane>
                <Button fx:id="videoToggleButton"
                        onAction="#handleVideoToggle"
                        prefWidth="58" prefHeight="58"
                        style="-fx-background-color: #4a4a4a; -fx-background-radius: 50%; -fx-cursor: hand; -fx-border-color: transparent; -fx-border-width: 0;">
                    <graphic>
                        <Label text="ðŸŽ¥" style="-fx-font-size: 24px;"/>
                    </graphic>
                </Button>
            </StackPane>
            <Label fx:id="videoLabel" text="Camera On"
                   style="-fx-text-fill: #b8b8b8; -fx-font-size: 11px; -fx-font-weight: 600;"/>
        </VBox>

        <!-- End Call Button (Larger & Red) -->
        <VBox alignment="CENTER" spacing="6">
            <StackPane>
                <Button fx:id="endCallButton"
                        onAction="#handleEndCall"
                        prefWidth="65" prefHeight="65"
                        style="-fx-background-color: #d13438; -fx-background-radius: 50%; -fx-cursor: hand; -fx-border-color: transparent; -fx-border-width: 0; -fx-effect: dropshadow(gaussian, rgba(209,52,56,0.5), 15, 0, 0, 3);">
                    <graphic>
                        <Label text="ðŸ“ž" style="-fx-font-size: 28px; -fx-rotate: 135;"/>
                    </graphic>
                </Button>
            </StackPane>
            <Label text="End Call"
                   style="-fx-text-fill: #ff6b6b; -fx-font-size: 11px; -fx-font-weight: bold;"/>
        </VBox>

        <!-- Switch Camera Button -->
        <VBox alignment="CENTER" spacing="6">
            <StackPane>
                <Button fx:id="switchCameraButton"
                        onAction="#handleSwitchCamera"
                        prefWidth="58" prefHeight="58"
                        style="-fx-background-color: #4a4a4a; -fx-background-radius: 50%; -fx-cursor: hand; -fx-border-color: transparent; -fx-border-width: 0;">
                    <graphic>
                        <Label text="ðŸ”„" style="-fx-font-size: 24px;"/>
                    </graphic>
                </Button>
            </StackPane>
            <Label text="Switch"
                   style="-fx-text-fill: #b8b8b8; -fx-font-size: 11px; -fx-font-weight: 600;"/>
        </VBox>

    </HBox>

</VBox>